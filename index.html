<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Code Editor</title>
    <script src="https://ajaxorg.github.io/ace-builds/src/ace.js"></script>
    <style type="text/css" media="screen">
        .ace_editor {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <div oninput="myinput()" onkeydown="onkey()" on id="editor"></div>

    <!-- <textarea id="editor"></textarea> -->
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>

    <script>
        const socket = io();
        const codeEditor = document.getElementById('editor');

        // Initialize Ace Editor
        const editor = ace.edit("editor");
        editor.setTheme("ace/theme/twilight");
        editor.session.setMode("ace/mode/javascript");


        // Listen for code updates
        socket.on('update', (code) => {
            // editor.session.insert({row: editor.session.getLength(), column: 0}, code);
            editor.setValue(code);
            editor.clearSelection();
        });

        function myinput() {
            console.log("mm");
            const code = editor.getValue();
            if (code == "") {
                socket.emit('update', "blank");
            }
            socket.emit('update', code);
        }
        function onkey(params) {
            console.log(params);
        }

        document.getElementById('editor').addEventListener('keydown', function (event) {
            if (event.code == 'Delete') {
                console.log('The physical key pressed was the DELETE key');
            }
            if (event.code == 'Backspace') {
                console.log('The physical key pressed was the BACKSPACE key');
            }
            if (event.key == 'Delete') {
                console.log('The keypress meant the same as pressing DELETE');
                // This can happen for one of two reasons:
                // 1. The user pressed the DELETE key
                // 2. The user pressed FN+BACKSPACE on a small Mac keyboard where
                //    FN+BACKSPACE deletes the character in front of the text cursor,
                //    instead of the one behind it.
            }
            if (event.key == 'Backspace') {
                console.log('The keypress meant the same as pressing BACKSPACE');
            }
        });

        // Update code and emit the changes
        editor.session.addEventListener('exec', (d) => {
            console.log("change");
            console.log(d);
            const code = editor.getValue();
            socket.emit('update', code);
        });
        // editor.session.selection.on('changeSelection', function (e) {
        //     console.log("selection change");
        //     const code = editor.getValue();
        //     socket.emit('update', code);
        // });
    </script>
</body>

</html>